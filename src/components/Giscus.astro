---
// Giscus comment component
// https://giscus.app
---

<div class="giscus-container mt-16 pt-8 border-t border-neutral-200 dark:border-neutral-700">
	<h2 class="text-2xl font-bold mb-8">Comments</h2>
	<div class="giscus"></div>
</div>

<script>
	function loadGiscus() {
		const theme = document.documentElement.classList.contains('dark')
			? 'dark'
			: 'light'

		const script = document.createElement('script')
		script.src = 'https://giscus.app/client.js'
		script.setAttribute('data-repo', 'angrypark/angrypark.github.io')
		script.setAttribute('data-repo-id', 'R_kgDOPUtL4Q')
		script.setAttribute('data-category', 'General')
		script.setAttribute('data-category-id', 'DIC_kwDOPUtL4c4C0gre')
		script.setAttribute('data-mapping', 'pathname')
		script.setAttribute('data-strict', '0')
		script.setAttribute('data-reactions-enabled', '1')
		script.setAttribute('data-emit-metadata', '0')
		script.setAttribute('data-input-position', 'bottom')
		script.setAttribute('data-theme', theme)
		script.setAttribute('data-lang', 'ko')
		script.setAttribute('data-loading', 'lazy')
		script.crossOrigin = 'anonymous'
		script.async = true

		const container = document.querySelector('.giscus')
		if (container) {
			container.appendChild(script)
		}
	}

	function updateGiscusTheme() {
		const theme = document.documentElement.classList.contains('dark')
			? 'dark'
			: 'light'

		const iframe = document.querySelector<HTMLIFrameElement>(
			'iframe.giscus-frame'
		)
		if (iframe) {
			iframe.contentWindow?.postMessage(
				{ giscus: { setConfig: { theme } } },
				'https://giscus.app'
			)
		}
	}

	// Load Giscus on page load
	loadGiscus()

	// Listen for theme changes
	const observer = new MutationObserver((mutations) => {
		mutations.forEach((mutation) => {
			if (mutation.attributeName === 'class') {
				updateGiscusTheme()
			}
		})
	})

	observer.observe(document.documentElement, { attributes: true })
</script>
